<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
    <script src="https://www.x3dom.org/download/x3dom.js"></script>
</head>
<body>
    <script>
        let boxId = 'BoxId';
        let lastNode = null;
        function setBoxId(i) {
            console.log('a',  i)
            boxId = i;
            if (lastNode) {
                document.getElementById('scene').removeChild(lastNode);
            }
            let r = document.createElement('route');
            r.setAttribute('fromField', 'value_changed');
            r.setAttribute('fromNode', 'BoxChaser');
            r.setAttribute('toField', 'set_translation');
            r.setAttribute('toNode', i)
            console.log('b')
            //console.log(document.getElementById('route').getAttribute('toNode'))
            console.log('c')
            document.getElementById('scene').appendChild(r);
            console.log(r)
            lastNode = r;
            console.log('c')
            //document.getElementById('route').setAttribute('toNode',i)
        }

        function move(point, event) {
            event.hitPoint = null;
            console.log(event);
            console.log(point);
            console.log(document.getElementById(boxId).getAttribute('translation'))
            document.getElementById("BoxChaser").setAttribute("set_destination", point)
        };
   </script>
    <X3D>
        <Scene id="scene">
            <PositionChaser DEF="BoxChaser" id="BoxChaser" duration="1" initialDestination="-3 0 0"></PositionChaser>
            <Transform onClick="move(event.hitPnt,event);">
                <Shape>
                    <Appearance>
                        <Material></Material>
                    </Appearance><Box size="10 0.1 10"></Box>
                </Shape>
            </Transform>
            <Transform DEF="Box" id="Box" onClick="setBoxId('Box');">
                <Shape>
                    <Appearance>
                        <Material diffuseColor="#773333">
                        </Material>
                    </Appearance>
                    <Box></Box>
                </Shape>
            </Transform>
            <Transform DEF="Box2" id="Box2" onClick="setBoxId('Box2');" translation="2 0 0">
                <Shape>
                    <Appearance>
                        <Material diffuseColor="#335599"></Material>
                    </Appearance>
                    <Box></Box>
                </Shape>
            </Transform>

            <!--<ROUTE fromNode="BoxChaser" fromField="value_changed" toNode="" id="route" toField="set_translation"></ROUTE>-->
        </Scene>
    </X3D>
    <style>
        x3d, canvas {
            width: 100%
        }
    </style>
</body>
</html>
